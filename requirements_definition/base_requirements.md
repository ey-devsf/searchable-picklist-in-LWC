# Searchable Picklist In LWC.

# 背景

Salesforceのカスタム画面を作る際に、プルダウン形式の選択ボックスで、選択肢が多いと検索機能が必要になる。例えば、項目を選択させる場合に項目数は最大800項目あり、プルダウンで選択するのは難しい。しかし、標準で検索×プルダウン形式のコンポーネントが存在しない。

# 概要

LWCで汎用的に使える検索×プルダウン形式のinput-boxを開発する。

- 汎用的とは？
    - 他のLWCに埋め込めること
    - 選択リストを親コンポーネントから受け取れること
    - 親コンポーネントからのパラメータで選択リストをソートできる
    - 入力値、選択したオプション、検索結果のリストを親コンポーネントからも参照できること

# 機能

- パラメータ
    - options
        - プルダウンの選択肢
        - 必須プロパティとして、label と value をもつ
        - 任意のプロパティが含まれていても動作すること
    - initValue
        - デフォルトでセットしたい値があれば指定できる
    - initSearchValue
        - デフォルトで検索したい文字列があれば指定できる
- 戻り値
    - inputText
        - 検索ボックスに入力された値
    - selectedOption
        - セレクトした値
- イベント
    - 検索ボックス
        - onfocus
            - プルダウンの選択リストを表示する
            - 既に検索ワードが入力済みの場合は、その検索ワードでフィルタした選択リストのみを表示する
        - onchange
            - 変更が入ったら、そのワードで再度フィルタした選択リストのみを表示する
        - onblur
            - フォーカスアウトしたとき、
                - 選択リストにフォーカスアウトした場合 → 何もしない
                - 選択リスト外にフォーカスアウトした場合 → 今の検索ワードで完全一致する選択肢が1件のみであればそれをselectedOptionとして扱う。その後、選択リストを非表示にする
        - タブキーの押下／キーボードの下（↓）を押した場合
            - 検索ボックスにカーソルが当たった状態でタブキーもしくは↓を押したら選択リストの先頭の選択肢にフォーカスが移動する
    - 選択リスト
        - onclick
            - 選択した選択肢をselectedOptionとして扱う
            - 選択リストを非表示にする
        - 特定の選択肢にフォーカスが当たった状態でEnterキーを押した場合
            - フォーカスが当たっていた選択肢をselectedOptionとして扱う
        - タブキーの押下
            - 次の選択肢にフォーカスを移動する
            - 最上位／最下位の選択肢でタブキーを押したら検索ボックスにフォーカスを戻す
        - 上下キーの押下
            - ↑を押したら1つ前の選択肢／↓を押したら次の選択肢に移動する
            - 最上位／最下位の選択肢で↑↓を押したら検索ボックスにフォーカスを戻す
- その他
    - lightning-inputは使わない。
    - 一般的なHTMLタグを使う